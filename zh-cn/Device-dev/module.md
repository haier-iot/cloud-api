# 物联模组类
  设备采用物联模组的方式，接入到 U+ IoT平台，并通过 U+ IoT平台进行APP端与设备的交互，进而进行智能控制。

![智能模块接入平台图][pic1]

## 基本功能

**设备接入与控制**

&emsp;&emsp;设备自绑定  
&emsp;&emsp;设备控制  
&emsp;&emsp;数据上报  
&emsp;&emsp;属性和报警上报   
&emsp;&emsp;FOTA升级  
&emsp;&emsp;OTA升级  



## 开发文档

### WIFI模块设备开发

**1.上电流程**

上电流程是指设备给模块上电之后必须完成的初始化工作，模块与设备的交互流程具体如下图所示：

![上电流程图][pic2]

**2.正常控制流程**

正常控制流程是指模块与设备处于正常工作状态时，通过模块对设备下发控制命令，设备按照命令执行。根据下发命令的类型不同，分为单命令控制流程和组命令控制流程，具体交互流程如下图。

**单命令控制流程**

交互流程见下图：

![单命令控制流程图][pic3]

**组命令控制流程**

交互流程见下图：

![组命令控制流程图][pic4]

**3.主动汇报流程**

主动汇报流程是指通过模块将设备的属性状态主动上报至云平台。需注意的是，只有设备属性状态发生变化时，才会发起主动汇报流程。

**正常汇报流程**

设备属性状态发生变化时，主动汇报正常交互流程见下图：

![主动汇报正常汇报流程图][pic5]

**主动汇报重发流程** 

设备属性状态发生变化时，主动汇报流程若出现异常，会发起主动汇报重发流程，具体交互流程见下图：

![主动汇报重发流程图][pic6]

**4.汇报配置流程** 

当配置用户信息或者大数据信息汇报时，会发起汇报配置流程。

**正常配置流程**

交互流程见下图：

![正常配置流程图][pic7]


**5.报警流程** 

当网络家电设备的报警信息变化时，发送报警状态汇报帧给通信模块。通信模块接收到报警帧后，在限定的时间内(50ms)发送确认帧给网络家电设备。若网络家电设备未收到确认帧，则网络家电设备按照一定的时间间隔(300ms)重新发送报警信息，直到收到通信模块发送的确认帧。

如果在接到确认帧后的一段时间(5s)内，并没有解除警报(网络家电设备未接收到停止故障报警帧)，则继续以300ms间隔发送报警帧。

**正常报警流程**

交互流程见下图：

![正常报警流程图][pic8]

**报警重发流程**

交互流程见下图：

![报警重发流程图][pic9]

**6.模块设置**

**网络状态查询**

当设备需要知道模块的网络状态时，会进行主动查询，网络状态查询交互流程如下图，若没有特殊情况，也可使用F7帧代替此功能。

![模块网络状态查询图][pic10]

**进入设置模式**

设备发送模块进入设置模式帧，让模块进入设置模式。模块回复模块进入设置模式应答帧，进入设置模式。如模块无应答，设备重发2次模块进入设置模式帧，间隔300ms。

有显示能力的网络家电设备，在启动设置模块后(收到模块进入设置模式应答帧)可以进行相应的显示提示。

网络家电设备启动后可多次触发进入设置。

交互流程见下图：

![模块进入设置模式图][pic11]

**退出设置模式**

模块进入设置模式后，超过预定时间还未配置完成或者在预定时间内的人为强制操作，设备向模块发送模块进入工作模式帧，强制模块退出配置模式。模块回复应答模块进入工作模式帧，进入正常工作模式。

交互流程见下图：

![模块退出设置模式图][pic12]

**模块主动退出设置模式**

模块进入设置模式，超过预定时间还未设置完成，模块向设备发送主动汇报网络状态帧，退出设置模式。设备回复确认帧，根据网络状态帧进行状态显示。

模块进入设置模式后，如果模块设置完成，模块向设备发送主动汇报网络状态帧，退出设置模式。设备回复确认帧，根据网络状态帧进行状态显示。

交互流程见下图：

![模块主动退出设置模式图][pic13]

### 蓝牙模块设备开发

**1.蓝牙联动配对流程(网关侧)**

**配对成功流程**

![蓝牙联动配对成功流程图][pic14]

**不允许配对流程**

交互流程见下图：

![蓝牙联动不允许配对流程图(网关侧)][pic15]

**配对超时流程**

交互流程见下图：

![配对超时流程图][pic16]

**2.蓝牙解除联动配对流程(网关侧)**

交互流程见下图：

![蓝牙解除联动配对流程图(网关侧)][pic17]

**3.蓝牙配对流程(待配对侧)**

交互流程见下图：

![蓝牙配对流程图(待配对侧)][pic18]

**4.联动流程(网关侧)**

**联动上报流程**

交互流程见下图：

![联动上报流程图(网关侧)][pic19]

 **5.联动控制流程**

当蓝牙模块设备与WIFI蓝牙设备配对成功之后，即可进行正常联动控制流程，交互流程见下图：

![联动控制流程图][pic20]

 

**6.设置蓝牙发射功率**

交互流程见下图：

![设置蓝牙发射功率图][pic21]

**7.清除配置信息**

交互流程见下图：

![清除配置信息图][pic22]

常用图片注释

[pic1]:../Device-dev/_media/_module/pic1.png
[pic2]:../Device-dev/_media/_module/pic2.png
[pic3]:../Device-dev/_media/_module/pic3.png
[pic4]:../Device-dev/_media/_module/pic4.png
[pic5]:../Device-dev/_media/_module/pic5.png
[pic6]:../Device-dev/_media/_module/pic6.png
[pic7]:../Device-dev/_media/_module/pic7.png
[pic8]:../Device-dev/_media/_module/pic8.png
[pic9]:../Device-dev/_media/_module/pic9.png
[pic10]:../Device-dev/_media/_module/pic10.png
[pic11]:../Device-dev/_media/_module/pic11.png
[pic12]:../Device-dev/_media/_module/pic12.png
[pic13]:../Device-dev/_media/_module/pic13.png
[pic14]:../Device-dev/_media/_module/pic14.png
[pic15]:../Device-dev/_media/_module/pic15.png
[pic16]:../Device-dev/_media/_module/pic16.png
[pic17]:../Device-dev/_media/_module/pic17.png
[pic18]:../Device-dev/_media/_module/pic18.png
[pic19]:../Device-dev/_media/_module/pic19.png
[pic20]:../Device-dev/_media/_module/pic20.png
[pic21]:../Device-dev/_media/_module/pic21.png
[pic22]:../Device-dev/_media/_module/pic22.png

